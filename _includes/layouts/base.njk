<!doctype html>
<html lang="{{ metadata.language or 'pt-BR' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/img/logo.png">
  <title>{{ title or metadata.title }}</title>
  <meta name="description" content="{{ description or metadata.description }}">
  
  <!-- CSS -->
  <style>{% include "css/index.css" %}</style>
  <style>{% getBundle "css" %}</style>

  <!-- Optional JS -->
  <script type="module">{% include "node_modules/@zachleat/heading-anchors/heading-anchors.js" %}</script>
</head>
<body>
  <!-- Skip link -->
  <a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

  <!-- Header / Menu -->
  <header class="site-header">
    <div class="site-logo">
      <img src="/img/logo.png" alt="logo" eleventy:ignore>
    </div>    
    <nav>
      <ul class="nav">
        {%- for page in collections.all | eleventyNavigation %}
          {%- set hasChildren = page.children and page.children.length > 0 %}

          <li class="nav-item {% if hasChildren %}has-submenu{% endif %}">
            
            <a href="{{ page.url }}">
              {{ page.title }}
            </a>

            {% if hasChildren %}
              <ul class="submenu">
                {% for child in page.children %}
                  <li>
                    <a href="{{ child.url }}">
                      {{ child.title }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}

          </li>
        {%- endfor %}
      </ul>
    </nav>

  </header>

  <!-- Main Content -->
  <main id="main">
    
      {# HOME: slides e seções opcionais #}
      {% if slides %}
        <section class="hero-slider reveal">
          {{ slides | safe }}
        </section>
      {% endif %}

      {% if home_section_1 %}
        <section class="home-section section-white reveal">
          {{ home_section_1 | safe }}
        </section>
      {% endif %}

      {% if home_section_2 %}
        <section class="home-section section-magenta reveal">
          {{ home_section_2 | safe }}
        </section>
      {% endif %}

      {# SERVIÇOS #}
      {% if services %}
        <section class="home-section section-white reveal">
          {{ services | safe }}
        </section>
      {% endif %}

      {% if upcoming_events %}
        <section class="home-section section-magenta reveal">
          {{ upcoming_events | safe }}
        </section>
      {% endif %}

      {# PÁGINAS GERAIS: Contato, Quem Somos, etc #}
      {% if content %}
        <section class="home-section reveal">
          <div class="content">

            {% if title %}
              <h1 class="page-title">{{ title }}</h1>
            {% endif %}

            {{ content | safe }}
          </div>
        </section>
      {% endif %}
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container footer-content">
      <p>
        <strong> © Casa Mater </strong>— Todos los derechos reservados
      </p>

      <p class="footer-dev">
        Desarrollo Web por <strong>Juliana Rodrigues</strong>
      </p>
    </div>
  </footer>

  <!-- JS Bundle -->
  <script type="module" src="{% getBundleFileUrl "js" %}"></script>

  <!-- Scroll Reveal -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const reveals = document.querySelectorAll(".reveal");

      const observer = new IntersectionObserver(
        entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add("is-visible");
              observer.unobserve(entry.target);
            }
          });
        },
        {
          threshold: 0.15
        }
      );

      reveals.forEach(el => observer.observe(el));
    });
  </script>

  <!-- Menu Reveal -->
  <script>
    const header = document.querySelector('.site-header');
    let lastScroll = window.scrollY;

    // no topo, o menu começa visível
    header.classList.remove('is-hidden');

    window.addEventListener('scroll', () => {
      const currentScroll = window.scrollY;

      // se estiver no topo → sempre visível
      if (currentScroll <= 0) {
        header.classList.remove('is-hidden');
        lastScroll = 0;
        return;
      }

      // rolando para cima → esconde
      if (currentScroll < lastScroll) {
        header.classList.add('is-hidden');
      } 
      // rolando para baixo → mostra
      else {
        header.classList.remove('is-hidden');
      }

      lastScroll = currentScroll;
    });
  </script>
  
  <!-- Menu galery -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const track = document.querySelector(".gallery-track");
      const prev = document.querySelector(".gallery-arrow.left");
      const next = document.querySelector(".gallery-arrow.right");

      let items = Array.from(document.querySelectorAll(".gallery-item"));

      const visible = window.innerWidth <= 768 ? 1 : 3;
      let index = visible;

      // clona últimos
      items.slice(-visible).forEach(item => {
        const clone = item.cloneNode(true);
        clone.classList.add("clone");
        track.prepend(clone);
      });

      // clona primeiros
      items.slice(0, visible).forEach(item => {
        const clone = item.cloneNode(true);
        clone.classList.add("clone");
        track.appendChild(clone);
      });

      // atualiza lista após clonar
      items = Array.from(document.querySelectorAll(".gallery-item"));

      const total = items.length;

      function update(animate = true) {
        track.style.transition = animate ? "transform 0.5s ease" : "none";
        const move = (100 / visible) * index;
        track.style.transform = `translateX(-${move}%)`;
      }

      // posição inicial
      update(false);

      next.addEventListener("click", () => {
        index++;
        update();

        if (index === total - visible) {
          setTimeout(() => {
            index = visible;
            update(false);
          }, 500);
        }
      });

      prev.addEventListener("click", () => {
        index--;
        update();

        if (index === 0) {
          setTimeout(() => {
            index = total - visible * 2;
            update(false);
          }, 500);
        }
      });
    });
  </script>

</body>
</html>
